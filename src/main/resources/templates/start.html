<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:lang="${#locale.language}" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Select language</title>
  <style>
    :root{
      --bg:#f8fafc; --card:#ffffff; --text:#0f172a; --muted:#64748b; --border:#e2e8f0;
      --accent:#2563eb; --accent-700:#1d4ed8;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:Inter, ui-sans-serif, -apple-system, Segoe UI, Roboto, Arial, sans-serif; line-height:1.55;
    }
    .wrap{max-width:960px;margin:28px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:22px}
    h1{margin:0 0 10px;font-size:1.5rem}
    p.lead{margin:0 0 16px;color:#374151}
    .muted{color:#64748b}

    .langs{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 16px}
    .chip{
      display:inline-flex;align-items:center;gap:10px;border:1px solid var(--border);
      border-radius:999px;padding:8px 12px;background:#fff;cursor:pointer
    }
    .chip input{
      appearance:none;width:16px;height:16px;border:2px solid var(--border);
      border-radius:999px;display:inline-block
    }
    .chip input:checked{border-color:var(--accent);box-shadow:0 0 0 3px #dbeafe inset;background:var(--accent)}
    .chip .title{font-weight:800}

    .actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
    .btn{
      display:inline-block;padding:12px 18px;border-radius:12px;border:1px solid var(--accent);
      background:var(--accent);color:#fff;font-weight:800;text-decoration:none;cursor:pointer
    }
    .btn:hover{background:var(--accent-700);border-color:var(--accent-700)}
    .btn.outline{background:#fff;color:var(--accent);border-color:var(--border)}
  </style>
</head>

<body>
<main class="wrap"
      th:with="selected=${currentLang != null ? currentLang : 'en'},
               locked=${langLocked != null ? langLocked : false}">
  <section class="card">

    <h1 th:text="${selected=='hi' ? 'टेस्ट शुरू करने से पहले' : (selected=='mr' ? 'चाचणी सुरू करण्यापूर्वी' : 'Before you start')}">
      Before you start
    </h1>

    <!-- Unlocked -->
    <div th:if="${!locked}">
      <p id="disc" class="lead">
        Once you confirm your language and continue to the gating pages, you won't be able to change it later. Please decide now.
      </p>

      <form id="langForm" th:action="@{/language/set}" method="post" novalidate>
        <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}" />
        <div class="langs" id="langChips" th:data-initial="${selected}">
          <label class="chip">
            <input type="radio" name="lang" value="en" th:checked="${selected=='en'}" />
            <span class="title">English</span>
          </label>
          <label class="chip">
            <input type="radio" name="lang" value="hi" th:checked="${selected=='hi'}" />
            <span class="title">हिन्दी</span>
          </label>
          <label class="chip">
            <input type="radio" name="lang" value="mr" th:checked="${selected=='mr'}" />
            <span class="title">मराठी</span>
          </label>
        </div>

        <div class="actions">
          <button type="submit" class="btn" name="action" value="start">Continue</button>
        </div>
      </form>
    </div>

    <!-- Locked -->
    <div th:if="${locked}">
      <p class="lead muted">
        Language is already set for your account. You can continue to the gating questions.
      </p>
      <div class="actions">
        <a class="btn" th:href="@{/gating}">Continue</a>
      </div>
    </div>

  </section>
</main>

<script>
  // Localized disclaimer text
  const DISCLAIMER = {
    en: "Once you confirm your language and continue to the gating pages, you won't be able to change it later. Please decide now.",
    hi: "भाषा तय करके गेटिंग पेजों पर आगे बढ़ने के बाद, आप भाषा नहीं बदल पाएंगे। कृपया अभी निर्णय लें।",
    mr: "भाषा निश्चित करून गेटिंग पानांवर पुढे गेल्यावर, नंतर भाषा बदलता येणार नाही. कृपया आत्ताच ठरवा."
  };

  const chips = document.getElementById('langChips');
  const disc  = document.getElementById('disc');

  function setDisclaimer(lang){
    if (disc) disc.textContent = DISCLAIMER[lang] || DISCLAIMER.en;
  }

  if (chips) {
    const initial = chips.dataset.initial || 'en';
    setDisclaimer(initial);
    chips.addEventListener('change', (e)=>{
      if (e.target && e.target.name === 'lang') {
        setDisclaimer(e.target.value);
      }
    });
  }
</script>
</body>
</html>