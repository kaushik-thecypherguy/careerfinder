<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title th:text="${rec.title}">Result</title>
  <style>
    :root{ --bg:#f6f7fb; --card:#ffffff; --text:#0f172a; --muted:#64748b; --border:#e5e7eb; --accent:#2563eb; --accent-700:#1d4ed8; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter, ui-sans-serif, -apple-system, Segoe UI, Roboto, Arial, sans-serif}
    .wrap{max-width:1100px;margin:36px auto;padding:0 16px;display:grid;grid-template-columns:2fr 1fr;gap:18px}
    @media (max-width:960px){.wrap{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;box-shadow:0 1px 8px rgba(0,0,0,.04)}
    h1{margin:0 0 8px;font-size:1.4rem}
    h2{margin:18px 0 10px;font-size:1.1rem}
    p.lead{margin:0 0 6px;color:var(--muted)}
    ul{margin:8px 0 0 20px}
    a.link{color:var(--accent);font-weight:700;text-decoration:none}
    a.link:hover{color:var(--accent-700);text-decoration:underline}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:10px;border-bottom:1px solid var(--border);vertical-align:top}
    th{width:44%;color:#475569;text-align:left}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#eef2ff;color:#3730a3;font-weight:700;font-size:.85rem}

    /* tiny bar */
    .row{display:flex;align-items:center;gap:10px;margin:6px 0}
    .trait{flex:0 0 58%}
    .meter{flex:1 1 auto;height:10px;border-radius:999px;background:#e5e7eb;overflow:hidden}
    .fill{height:100%;background:var(--accent)}
    .val{width:46px;text-align:right;font-variant-numeric:tabular-nums;color:#334155}
  </style>
</head>
<body>
<main class="wrap">

  <!-- NEW: trait profile (left column) -->
  <section class="card" th:if="${profile != null}">
    <h2>Trait profile (0â€“100)</h2>

    <!-- 12 traits -->
    <div th:each="e : ${profile.traitFinal0to100().entrySet()}">
      <div class="row">
        <div class="trait"
             th:text="${T(com.acf.careerfinder.psychometrics.ScoringConfig).traitLabel(e.key)}">Trait name</div>
        <div class="meter"><div class="fill" th:style="${'width:' + e.value + '%'}"></div></div>
        <div class="val" th:text="${#numbers.formatDecimal(e.value,1, 'POINT', 1, 'POINT')}">0.0</div>
      </div>
    </div>

    <!-- optional: OCEAN -->
    <h2 style="margin-top:14px;color:#475569">Domains</h2>
    <div th:each="d : ${profile.ocean0to100().entrySet()}">
      <div class="row">
        <div class="trait"
             th:text="${T(com.acf.careerfinder.psychometrics.ScoringConfig).domainLabel(d.key)}">Domain</div>
        <div class="meter"><div class="fill" th:style="${'width:' + d.value + '%'}"></div></div>
        <div class="val" th:text="${#numbers.formatDecimal(d.value,1, 'POINT', 1, 'POINT')}">0.0</div>
      </div>
    </div>
  </section>

  <!-- LEFT: recommendations (existing) -->
  <section class="card">
    <h1 th:text="${rec.title}">Your result</h1>
    <p class="lead" th:text="${rec.summary}">Summary goes here</p>

    <h2 th:text="${rec.careersTitle}">Suggested careers/trades</h2>
    <ul>
      <li th:each="c : ${rec.suggestedCareers}">
        <a class="link" th:href="${c.href}" th:text="${c.label}" target="_blank" rel="noopener">Career</a>
      </li>
    </ul>

    <h2 th:text="${rec.nextTitle}">Next steps</h2>
    <ul>
      <li th:each="s : ${rec.nextSteps}" th:text="${s}">Step</li>
    </ul>
  </section>

  <!-- RIGHT: answers echo (existing) -->
  <aside class="card">
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
      <div class="badge" th:text="${rec.answersTitle}">Your answers</div>
    </div>

    <table>
      <tbody>
      <!-- Prefer AI-prepared localized rows -->
      <tr th:if="${rec.answersEcho != null && !#lists.isEmpty(rec.answersEcho)}"
          th:each="row : ${rec.answersEcho}">
        <th th:text="${row.label}">Question</th>
        <td th:text="${row.value}">Answer</td>
      </tr>

      <!-- Fallback to legacy echo -->
      <tr th:if="${(rec.answersEcho == null || #lists.isEmpty(rec.answersEcho))
                   and (rec.echoAnswers == null || #lists.isEmpty(rec.echoAnswers))}">
        <td colspan="2" style="color:#6b7280">No answers found.</td>
      </tr>
      <tr th:if="${rec.answersEcho == null || #lists.isEmpty(rec.answersEcho)}"
          th:each="e : ${rec.echoAnswers}">
        <th th:text="${e.key}">Question</th>
        <td th:text="${e.value}">Answer</td>
      </tr>
      </tbody>
    </table>
  </aside>
</main>
</body>
</html>